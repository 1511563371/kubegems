apiVersion: plugins.kubegems.io/v1beta1
kind: Plugin
metadata:
  name: kubegems-local
  namespace: "{{ .Release.Namespace }}"
spec:
  kind: helm
  enabled: true
  dependencies:
    - name: cert-manager
  values:
    agent:
      extraArgs:
        - --api-prometheusserver={{ include "monitoring.prometheus.address" . }}
        - --api-alertmanagerserver={{ include "monitoring.alertmanager.address" . }}
        - --api-lokiserver={{ include "logging.loki.address" . }}
        - --api-jaegerserver={{ include "observability.jaeger.address" . }}
      image:
        {{ include "common.images.registry" . }}
        {{ include "common.images.repository" ( dict "repository" "kubegems/kubegems" "context" .) }}
        tag: "{{ .Values.kubegems.version }}"
    controller:
      image:
        {{ include "common.images.registry" . }}
        {{ include "common.images.repository" ( dict "repository" "kubegems/kubegems" "context" .) }}
        tag: "{{ .Values.kubegems.version }}"
