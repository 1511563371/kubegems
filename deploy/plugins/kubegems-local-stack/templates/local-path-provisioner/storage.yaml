{{- if index .Values "local-path" "enabled" -}}
# local-path-provisioner
# https://github.com/rancher/local-path-provisioner/tree/master/deploy/chart
apiVersion: plugins.kubegems.io/v1beta1
kind: Plugin
metadata:
  name: local-path-provisioner
  namespace: "{{ .Release.Namespace }}"
spec:
  enabled: true
  kind: helm
  installNamespace: {{ index .Values "local-path" "namespace" }}
  repo: https://github.com/rancher/local-path-provisioner/archive/refs/tags/v{{ index .Values "local-path" "version" }}.tar.gz
  path: local-path-provisioner-{{ index .Values "local-path" "version" }}/deploy/chart/local-path-provisioner
  version: "{{ index .Values "local-path" "version" }}"
  values:
    storageClass:
      defaultClass: true
      provisionerName: rancher.io/local-path
    nodePathMap:
    - node: DEFAULT_PATH_FOR_NON_LISTED_NODES
      paths:
        - /data
    image:
      # repository: docker.io/rancher/local-path-provisioner
      {{ include "common.images.repository" ( dict "registry" "docker.io" "repository" "rancher/local-path-provisioner" "context" .) }}
    helperImage:
      # repository: docker.io/library/busybox
      {{ include "common.images.repository" ( dict "registry" "docker.io" "repository" "library/busybox" "context" .) }}
{{- end }}
---
# https://github.com/kubernetes-csi/external-snapshotter/tree/master/client/config/crd
apiVersion: plugins.kubegems.io/v1beta1
kind: Plugin
metadata:
  name: external-snapshotter
  namespace: "{{ .Release.Namespace }}"
spec:
  enabled: true
  kind: kustomize
  installNamespace: kube-system
  repo: https://github.com/kubernetes-csi/external-snapshotter/archive/refs/tags/v5.0.1.tar.gz
  path: external-snapshotter-5.0.1/client/config/crd
  version: 5.0.1
